 <!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="stylesheet" href="css/leaflet.css" />
    <link rel="stylesheet" href="css/leaflet-control-boxzoom.css" />
    <link rel="stylesheet" href="css/leaflet.contextmenu.css" />
    <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v0.0.4/leaflet.fullscreen.css' rel='stylesheet' />
	<style type="text/css">
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="lib/leaflet.js"></script>
    <script src="GeoData.js"></script>
    <script src="GeoJSON.js"></script>
    <script src="Algorithm.js"></script>
    <script src="Segment.js"></script>
    <script src="Rectangle.js"></script>
    <script src="Vector.js"></script>
    <script src="IntervalTree.js"></script>
    <script src="Interval.js"></script>
    <script src="Preprocessor.js"></script>
	<script src="lib/leaflet-dvf.js"></script>
	<script src="lib/leaflet.dvf.experimental.js"></script>
    <script type='text/javascript' src="lib/leaflet.restoreview.js"></script>
    <script src="lib/leaflet-control-boxzoom.js"></script>
    <script src="lib/leaflet.contextmenu.js"></script>
	<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v0.0.4/Leaflet.fullscreen.min.js'></script>
</head>
<body>
   <div id="map"></div>
   <script type="text/javascript"> 
       EPS = 2;

       var albatros = new GeoData('./data/albatros.csv', function() {
           console.log(albatros);

           var segments = preProcess(albatros);



           segments = [
               new Segment(new Vector(0, 1), new Vector(5, 1)),
               new Segment(new Vector(0, 0), new Vector(10, 0))
            ];

           segments = runAlgorithm(segments);
           display(segments);
       });

       var buttonsList = [{
           text: 'Print data to console',
           callback: function() {
               console.log("Loading albatros data...");
               var albatros = new GeoData('data/albatros.csv', function() {
                  console.log(albatros);
               });
           }
       }];

       var map = L.map('map', {
           fullscreenControl: true,
           detectRetina: true,
           reuseTiles: true,
           bounds: null,
           contextmenu: true,
           contextmenuWidth: 140,
           contextmenuItems: buttonsList
       });

       L.tileLayer('https://{s}.tiles.mapbox.com/v4/thomhurks.lifnnoec/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidGhvbWh1cmtzIiwiYSI6ImtENDluRmsifQ.Q4w4kAlNk0YfaRclQp4BMA', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            subdomains: ['a','b','c','d'],
            mapId: 'thomhurks.lifnnoec',
            token: 'pk.eyJ1IjoidGhvbWh1cmtzIiwiYSI6ImtENDluRmsifQ.Q4w4kAlNk0YfaRclQp4BMA',
            detectRetina: true,
            reuseTiles: true,
            bounds: null
		}).addTo(map);

       L.Control.boxzoom({ position:'topleft' }).addTo(map);

       var svg = d3.select(map.getPanes().overlayPane).append("svg"),
                g = svg.append("g").attr("class", "leaflet-zoom-hide");

       function display(segments) {

           //convert to GeoJSON
           var geoJSON = new GeoJSON();
           geoJSON.addSegments(segments);

           //Display it
           var transform = d3.geo.transform({point: projectPoint}),
                   path = d3.geo.path().projection(transform);

           if (!map.restoreView()) {
               var firstCoord = geoJSON.features[0].geometry.coordinates[0];
               map.setView(new L.LatLng(firstCoord[1], firstCoord[0]), 5);
           }

           var feature = g.selectAll("path")
                   .data(geoJSON.features)
                   .enter().append("path")
                   .attr('stroke-width', function(d) { return d.properties.edgeweight; })
                   .style("stroke-width", function(d) { return d.properties.edgeweight; })
                   .style("stroke-linecap", "round")
                   .style("stroke", "steelblue")
                   .style("fill", "none");

           // This is the zoomlevel at which the edgeweight variable corresponds 1-to-1 with screen pixel units.
           // Adjust this number to adjust how edges scale. This is basically a hack, but native SVG scaling
           // in Leaflet combined with D3 is like rocket science.
           var baseZoom = 8;

           map.on("viewreset", reset);
           reset();

           // Reposition the SVG to cover the features.
           function reset(e) {
               var newZoom = map.getZoom();
               var zoomDiff = newZoom - baseZoom;
               var scale = Math.pow(2, zoomDiff);

               var bounds = path.bounds(geoJSON),
                       topLeft = bounds[0],
                       bottomRight = bounds[1];

               // Add offset because D3 is silly.
               topLeft[0] -= 25;
               topLeft[1] -= 25;
               bottomRight[0] += 25;
               bottomRight[1] += 25;

               svg.attr("width", bottomRight[0] - topLeft[0])
                       .attr("height", bottomRight[1] - topLeft[1])
                       .style("left", topLeft[0] + "px")
                       .style("top", topLeft[1] + "px");

               g.attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");

               feature.attr("d", path);

               feature.attr('stroke-width', function(d) { return d.properties.edgeweight * scale; })
                       .style("stroke-width", function(d) { return d.properties.edgeweight * scale; });
           }

           // Use Leaflet to implement a D3 geometric transformation.
           function projectPoint(x, y) {
               var point = map.latLngToLayerPoint(new L.LatLng(y, x));
               this.stream.point(point.x, point.y);
           }
       }

        /*
       d3.json("data/paths.json", function(geoJSON) {
           display(geoJSON);
       });
        */

		var marker = L.marker([51.5, -0.09]).addTo(map);
		var circle = L.circle([51.508, -0.11], 500, {
		    color: 'red',
		    fillColor: '#f03',
		    fillOpacity: 0.5
		}).addTo(map);
		var polygon = L.polygon([
		    [51.509, -0.08],
		    [51.503, -0.06],
		    [51.51, -0.047]
		]).addTo(map);
	</script>
</body>
</html>

